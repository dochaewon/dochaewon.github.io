---
title: "VPC 통신 이슈 해결기 – Laravel 앱과 OpenSearch 구성하면서 부딪힌 문제들"
date: 2025-07-23
tags: [AWS, VPC, Laravel, OpenSearch, 네트워크, 보안그룹, 서버통신]
---

## 🚧 시작은 단순했다

Laravel 앱에서 OpenSearch를 붙이면 될 줄 알았다.  
OpenSearch는 EC2에 직접 설치했고, 앱 서버와 같은 AWS 리전에 배포했으니 잘 될 거라고 생각했다.


---

## ❗ 문제 상황

선호도 조사 API를 만들고, 프론트엔드 앱(React Native 기반)에서 직접 호출하는 구조였다.  
API 요청 시 사용자 ID도 함께 전달하는데, 프론트 개발자가 질문했다:

> "인증이 없나요?"

**퍼블릭 엔드포인트로 열려 있는 API는 VPC로 막아놔도 공격 대상이 될 수 있다는 것.**

뿐만 아니라:
- OpenSearch는 인증 없이 사용하고 있었고
- 앱은 유동 IP를 사용하므로 OpenSearch의 보안 그룹에서 IP 허용이 사실상 불가능

결국 구조를 다시 설계해야 했다.

---

## 🔍 원인 분석

### 1. **프론트에서 직접 호출 → 인증 노출 위험**

프론트엔드 앱에서 OpenSearch에 직접 붙는다면 인증 정보(API Key, Basic Auth 등)를 반드시 넣어야 한다.  
하지만 이 방식은 **빌드된 앱에서 인증 키가 노출될 위험**이 있고, 악의적 사용자가 네트워크 요청을 복제하거나 자동화해 API를 악용할 수 있다.

### 2. **VPC는 내부 보호망일 뿐, 외부 요청까지 방어하진 못함**

Laravel이 VPC 내부에서 OpenSearch에 안전하게 붙는다고 해도,  
**퍼블릭으로 열려 있는 API가 있다면 여전히 외부 공격은 가능**하다.  
특히 사용자 ID나 민감한 검색어가 포함될 경우, 비정상 트래픽 유입을 감지하고 차단하는 로직이 필요하다.

### 3. **앱의 IP는 유동 IP**

프론트 앱은 모바일 네트워크, 와이파이 등 다양한 환경에서 실행되며 IP가 고정되지 않는다.  
결과적으로 OpenSearch의 보안 그룹에서 허용된 IP로 제한하는 방식은 **현실적으로 불가능**하다.  
즉, OpenSearch를 퍼블릭하게 열지 않는 이상, 앱이 직접 붙는 것은 불가능하다.

---

## 🛠️ 해결 방법

### ✅ 방법 1: **OpenSearch는 절대 프론트에서 직접 호출하지 않기**

- Laravel 서버에서만 OpenSearch 호출
- 프론트는 Laravel API를 통해 간접 검색
- 인증 정보는 Laravel 내부에서만 관리

### ✅ 방법 2: **OpenSearch 접근 제한**

* Laravel 앱의 보안 그룹 ID만 OpenSearch 보안 그룹 인바운드에 추가
* IP가 아닌 **보안 그룹 → 보안 그룹 통신 허용** 방식으로 구성

---

## 🔐 보안 고려 사항 요약

| 항목            | 내용                              |
| ------------- | ------------------------------- |
| OpenSearch 접근 | Laravel 내부에서만 호출 (프론트 직접 접근 금지) |
| 네트워크 보안       | 보안 그룹 ID 기준으로 허용                |


---

## 🧠 내가 배운 점

| 항목             | 교훈                          |
| -------------- | --------------------------- |
| 프론트 직접 호출      | 인증 노출 + 오용 가능성 높음           |
| VPC만으로는 불충분    | 퍼블릭 API는 별도 인증/제한 필수        |
| 보안 그룹 관리       | IP보다 보안 그룹 ID가 더 안전하고 관리 쉬움 |
| 앱에서 직접 검색엔진 접근 | IP가 고정되지 않아 구조적으로 불가능함      |

---

## 🧱 마무리

처음엔 단순히 "VPC로 막으면 되겠지"라고 생각했지만,
**프론트에서 직접 호출하는 구조에서는 인증, 오용 방지, 호출 제한까지 다 신경 써야** 했다.

Laravel 서버만 OpenSearch에 접근하고,
프론트는 안전하게 중계된 API만 호출하도록 구조를 개선했다.

> 진짜 보안은 네트워크만으로 지켜지지 않는다.
> 인증, 트래픽 제어, 호출 경로 분리까지 모두 갖춰야 진짜 안전하다.

